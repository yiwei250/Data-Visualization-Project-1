<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Streaming Success Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        h3 {
            font-size: 15px; /* Fixed font size directly in CSS */
            color: grey;
        }
        .chart {
            margin: 50px auto;
            width: 600px;
            height: 400px;
        }
        .axis-label {
            font-size: 12px;
        }
        .title {
            text-align: center;
            margin: 20px;
            font-size: 24px;
        }
           .legend {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-right: 10px;
        }
        .legend-dot {
            width: 8px;
            height: 8px;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <h3>
        &nbsp; &nbsp; &nbsp;   Yining Wang (yw2622) &nbsp; &nbsp; &nbsp; Chenyu Yu (cy523) &nbsp; &nbsp; &nbsp; Yiwei Luo (yl3928)
    </h3>
<!-- Legends items for color samples -->
    <h1 class="title">Relationship between Musical Features and Spotify Streams</h1>
    <div class="legend">
        <div class="legend-item">
            <div class="legend-dot" style="background-color: orange;"></div>
            <span style = "color: orange">Danceability</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background-color: red;"></div>
            <span style = "color: red">Valence</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background-color: gold;"></div>
            <span style = "color: gold">Energy</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background-color: goldenrod;"></div>
            <span style = "color: goldenrod">Acousticness</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background-color: darkturquoise;"></div>
            <span style = "color: darkturquoise">Instrumentalness</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background-color: limegreen;"></div>
            <span style = "color: limegreen" >Liveness</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background-color: blue;"></div>
            <span style = "color: blue">Speechiness</span>
        </div>
    </div>

    <div id="danceability-chart" class="chart"></div>
    <div id="valence-chart" class="chart"></div>
    <div id="energy-chart" class="chart"></div>
    <div id="acousticness-chart" class="chart"></div>
    <div id="instrumentalness-chart" class="chart"></div>
    <div id="liveness-chart" class="chart"></div>
    <div id="speechiness-chart" class="chart"></div>

    <script>
        // Load CSV file using d3.csv
        d3.csv("Spotify Most Streamed Songs.csv").then(function(data) {
            // Convert relevant fields from strings to numbers
            data.forEach(function(d) {
                d.streams = +d["streams(10 million)"] * 10;  // Convert to unit of million to avoid cluttering
                d.danceability = +d["danceability_%"];
                d.valence = +d["valence_%"];
                d.energy = +d["energy_%"];
                d.acousticness = +d["acousticness_%"];
                d.instrumentalness = +d["instrumentalness_%"];
                d.liveness = +d["liveness_%"];
                d.speechiness = +d["speechiness_%"];
            });

            // Create separate charts for each attribute
            createChart(data, "danceability", "#danceability-chart", "Danceability (%)");
            createChart(data, "valence", "#valence-chart", "Valence (%)");
            createChart(data, "energy", "#energy-chart", "Energy (%)");
            createChart(data, "acousticness", "#acousticness-chart", "Acousticness (%)");
            createChart(data, "instrumentalness", "#instrumentalness-chart", "Instrumentalness (%)");
            createChart(data, "liveness", "#liveness-chart", "Liveness (%)");
            createChart(data, "speechiness", "#speechiness-chart", "Speechiness (%)");
        });

        function createChart(data, attribute, chartId, yLabel) {
            const width = 600, height = 400, margin = { top: 20, right: 30, bottom: 50, left: 70 };

            const svg = d3.select(chartId)
                          .append("svg")
                          .attr("width", width)
                          .attr("height", height);

            const xScale = d3.scaleLinear()
                             .domain(d3.extent(data, d => d.streams))
                             .range([margin.left, width - margin.right]);

            const yScale = d3.scaleLinear()
                             .domain([0, d3.max(data, d => d[attribute])])
                             .nice()
                             .range([height - margin.bottom, margin.top]);

            // Axes
            const xAxis = d3.axisBottom(xScale).ticks(10);
            const yAxis = d3.axisLeft(yScale);

            svg.append("g")
               .attr("transform", `translate(0,${height - margin.bottom})`)
               .call(xAxis)
               .append("text")
               .attr("x", width / 2)
               .attr("y", 35)
               .attr("fill", "black")
               .style("font-size", "12px")
               .style("text-anchor", "middle")
               .text("Streams Count");

            svg.append("g")
               .attr("transform", `translate(${margin.left},0)`)
               .call(yAxis)
               .append("text")
               .attr("transform", "rotate(-90)")
               .attr("x", -height / 2)
               .attr("y", -50)
               .attr("fill", "black")
               .style("font-size", "12px")
               .style("text-anchor", "middle")
               .text(yLabel);

            // jitter function
            //add a random number from negative min to positive max
            //the overscale issue is considered to limit the jitter size
            ////a jitter variable is here to determine to jitter size depends on situation
            // a minimum jitter variable is designed for scales with higher values of lowest numbers
            let max =0;
            let min = 0;
            function jitter() {
                return (Math.random() * (max-min) +min);
            }

            // use cluster locaiton of spots to determine jitter locaiton
            let Color = "red";
            let opa = 0.2;
            let jittery = false;

            if(chartId=="#danceability-chart") {
                    Color = "orange";
                    jittery = true;
                    max=10;
                    min = -10;
             }else if(chartId== "#valence-chart"){
                    Color = "red";
              }else if(chartId== "#energy-chart"){
                    Color = "gold";
                    opa = 0.5;
                    jittery = true;
                    max=10;
                    min = -10;
                    
                 }
                else if(chartId==  "#acousticness-chart"){
                    Color = "goldenrod";
                    opa = 0.5;
                    jittery = true;
                    max=10;
                    
                } else if(chartId=="#instrumentalness-chart"){
                    Color = "darkturquoise";
                    opa = 0.5;
                    jittery = true;
                    max=30;

                         }
                else if(chartId== "#liveness-chart"){
                     Color = "limegreen";
                    jittery = true;
                    max=10;
                    min = -8;

                    
                }else if(chartId== "#speechiness-chart"){
                    Color = "blue";
                    jittery = true;
                    max=5;
                    min = -7.5;

            }

            // scatterplot
            let plot = svg.selectAll(".dot")
               .data(data)
               .enter().append("circle")
               .attr("class", "dot")
               .attr("r", 4)
               .style("fill", Color)
               .style("opacity", opa);
            //jitter application
            if(jittery) {
                plot.attr("cx", d => xScale(d.streams))
                    .attr("cy", d => yScale(d[attribute]) - jitter());
            } else {
                plot.attr("cx", d => xScale(d.streams))
                    .attr("cy", d => yScale(d[attribute]));
            }
        }
    </script>
</body>
</html>
